{
  "version": 3,
  "sources": ["../../src/hosting-node.js"],
  "sourcesContent": ["/*\n\nWe have a separate node-specific hosting.js file for node.\nThis uses the node-specific APIs for making http requests,\nand doing lookups against local JSON and sqlite databases.\nThis is used in the CommonJS build of co2.js\n\nThis lets us keep the total library small, and dependencies minimal.\n*/\n\nimport https from \"https\";\n\nimport hostingJSON from \"./hosting-json.node.js\";\nimport { getApiRequestHeaders } from \"./helpers/index.js\";\n\n/**\n * Accept a url and perform an http request, returning the body\n * for parsing as JSON.\n *\n * @param {string} url\n * @param {string} userAgentIdentifier - Optional. The app, site, or organisation that is making the request.\n * @return {string}\n */\nasync function getBody(url, userAgentIdentifier) {\n  return new Promise(function (resolve, reject) {\n    // Do async job\n    const req = https.get(\n      url,\n      { headers: getApiRequestHeaders(userAgentIdentifier) },\n      function (res) {\n        if (res.statusCode < 200 || res.statusCode >= 300) {\n          return reject(\n            new Error(\n              `Could not get info from: ${url}. Status Code: ${res.statusCode}`\n            )\n          );\n        }\n        const data = [];\n\n        res.on(\"data\", (chunk) => {\n          data.push(chunk);\n        });\n\n        res.on(\"end\", () => resolve(Buffer.concat(data).toString()));\n      }\n    );\n    req.end();\n  });\n}\n\n/**\n * Check if a domain is hosted by a green web host.\n * @param {string|array} domain - The domain to check, or an array of domains to be checked.\n * @param {object} db - Optional. A database object to use for lookups.\n * @param {string} userAgentIdentifier - Optional. The app, site, or organisation that is making the request.\n * @returns {boolean|array} - A boolean if a string was provided, or an array of booleans if an array of domains was provided.\n */\n\nfunction check(domain, db, userAgentIdentifier) {\n  if (db) {\n    return hostingJSON.check(domain, db);\n  }\n\n  // is it a single domain or an array of them?\n  if (typeof domain === \"string\") {\n    return checkAgainstAPI(domain, userAgentIdentifier);\n  } else {\n    return checkDomainsAgainstAPI(domain, userAgentIdentifier);\n  }\n}\n\n/**\n * Check if a domain is hosted by a green web host by querying the Green Web Foundation API.\n * @param {string} domain - The domain to check.\n * @param {string} userAgentIdentifier - Optional. The app, site, or organisation that is making the request.\n * @returns {boolean} - A boolean indicating whether the domain is hosted by a green web host.\n */\nasync function checkAgainstAPI(domain, userAgentIdentifier) {\n  const res = JSON.parse(\n    await getBody(\n      `https://api.thegreenwebfoundation.org/greencheck/${domain}`,\n      userAgentIdentifier\n    )\n  );\n  return res.green;\n}\n\n/**\n * Check if an array of domains is hosted by a green web host by querying the Green Web Foundation API.\n * @param {array} domains - An array of domains to check.\n * @param {string} userAgentIdentifier - Optional. The app, site, or organisation that is making the request.\n * @returns {array} - An array of domains that are hosted by a green web host.\n */\nasync function checkDomainsAgainstAPI(domains, userAgentIdentifier) {\n  try {\n    const allGreenCheckResults = JSON.parse(\n      await getBody(\n        `https://api.thegreenwebfoundation.org/v2/greencheckmulti/${JSON.stringify(\n          domains\n        )}`,\n        userAgentIdentifier\n      )\n    );\n    return hostingJSON.greenDomainsFromResults(allGreenCheckResults);\n  } catch (e) {\n    return [];\n  }\n}\n\n/**\n * Take the result of a pageXray and check the domains in it against the database.\n * @param {object} pageXray - The result of a pageXray.\n * @param {object} db - A database object to use for lookups.\n * @returns {array} - An array indicating whether the domain is hosted by a green web host.\n */\nasync function checkPage(pageXray, db) {\n  const domains = Object.keys(pageXray.domains);\n  return check(domains, db);\n}\n\nexport default {\n  check,\n  checkPage,\n  greendomains: hostingJSON.greenDomainsFromResults,\n  loadJSON: hostingJSON.loadJSON,\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA,mBAAkB;AAElB,+BAAwB;AACxB,qBAAqC;AAUrC,uBAAuB,KAAK,qBAAqB;AAC/C,SAAO,IAAI,QAAQ,SAAU,SAAS,QAAQ;AAE5C,UAAM,MAAM,qBAAM,IAChB,KACA,EAAE,SAAS,yCAAqB,mBAAmB,EAAE,GACrD,SAAU,KAAK;AACb,UAAI,IAAI,aAAa,OAAO,IAAI,cAAc,KAAK;AACjD,eAAO,OACL,IAAI,MACF,4BAA4B,qBAAqB,IAAI,YACvD,CACF;AAAA,MACF;AACA,YAAM,OAAO,CAAC;AAEd,UAAI,GAAG,QAAQ,CAAC,UAAU;AACxB,aAAK,KAAK,KAAK;AAAA,MACjB,CAAC;AAED,UAAI,GAAG,OAAO,MAAM,QAAQ,OAAO,OAAO,IAAI,EAAE,SAAS,CAAC,CAAC;AAAA,IAC7D,CACF;AACA,QAAI,IAAI;AAAA,EACV,CAAC;AACH;AAUA,eAAe,QAAQ,IAAI,qBAAqB;AAC9C,MAAI,IAAI;AACN,WAAO,iCAAY,MAAM,QAAQ,EAAE;AAAA,EACrC;AAGA,MAAI,OAAO,WAAW,UAAU;AAC9B,WAAO,gBAAgB,QAAQ,mBAAmB;AAAA,EACpD,OAAO;AACL,WAAO,uBAAuB,QAAQ,mBAAmB;AAAA,EAC3D;AACF;AAQA,+BAA+B,QAAQ,qBAAqB;AAC1D,QAAM,MAAM,KAAK,MACf,MAAM,QACJ,oDAAoD,UACpD,mBACF,CACF;AACA,SAAO,IAAI;AACb;AAQA,sCAAsC,SAAS,qBAAqB;AAClE,MAAI;AACF,UAAM,uBAAuB,KAAK,MAChC,MAAM,QACJ,4DAA4D,KAAK,UAC/D,OACF,KACA,mBACF,CACF;AACA,WAAO,iCAAY,wBAAwB,oBAAoB;AAAA,EACjE,SAAS,GAAP;AACA,WAAO,CAAC;AAAA,EACV;AACF;AAQA,yBAAyB,UAAU,IAAI;AACrC,QAAM,UAAU,OAAO,KAAK,SAAS,OAAO;AAC5C,SAAO,MAAM,SAAS,EAAE;AAC1B;AAEA,IAAO,uBAAQ;AAAA,EACb;AAAA,EACA;AAAA,EACA,cAAc,iCAAY;AAAA,EAC1B,UAAU,iCAAY;AACxB;",
  "names": []
}
