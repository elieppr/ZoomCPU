"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.load = void 0;
const validations_1 = require("../util/validations");
const yaml_1 = require("../util/yaml");
const json_1 = require("../util/json");
const config_1 = require("../config");
/**
 * Parses manifest file as an object. Checks if parameter file is passed via CLI, then loads it too.
 * Returns context, tree and parameters (either the default one, or from CLI).
 */
const load = async (inputPath, paramPath) => {
    const rawManifest = await (0, yaml_1.openYamlFileAsObject)(inputPath);
    const { tree, ...context } = (0, validations_1.validateManifest)(rawManifest);
    const parametersFromCli = paramPath && (await (0, json_1.readAndParseJson)(paramPath)); // todo: validate json
    const parameters = parametersFromCli || config_1.PARAMETERS;
    return {
        tree,
        context,
        parameters,
    };
};
exports.load = load;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvbG9hZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxxREFBcUQ7QUFDckQsdUNBQWtEO0FBQ2xELHVDQUE4QztBQUU5QyxzQ0FBcUM7QUFHckM7OztHQUdHO0FBQ0ksTUFBTSxJQUFJLEdBQUcsS0FBSyxFQUFFLFNBQWlCLEVBQUUsU0FBa0IsRUFBRSxFQUFFO0lBQ2xFLE1BQU0sV0FBVyxHQUFHLE1BQU0sSUFBQSwyQkFBb0IsRUFBTSxTQUFTLENBQUMsQ0FBQztJQUMvRCxNQUFNLEVBQUMsSUFBSSxFQUFFLEdBQUcsT0FBTyxFQUFDLEdBQUcsSUFBQSw4QkFBZ0IsRUFBQyxXQUFXLENBQUMsQ0FBQztJQUN6RCxNQUFNLGlCQUFpQixHQUNyQixTQUFTLElBQUksQ0FBQyxNQUFNLElBQUEsdUJBQWdCLEVBQWEsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLHNCQUFzQjtJQUN0RixNQUFNLFVBQVUsR0FBRyxpQkFBaUIsSUFBSSxtQkFBVSxDQUFDO0lBRW5ELE9BQU87UUFDTCxJQUFJO1FBQ0osT0FBTztRQUNQLFVBQVU7S0FDWCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBWlcsUUFBQSxJQUFJLFFBWWYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3ZhbGlkYXRlTWFuaWZlc3R9IGZyb20gJy4uL3V0aWwvdmFsaWRhdGlvbnMnO1xuaW1wb3J0IHtvcGVuWWFtbEZpbGVBc09iamVjdH0gZnJvbSAnLi4vdXRpbC95YW1sJztcbmltcG9ydCB7cmVhZEFuZFBhcnNlSnNvbn0gZnJvbSAnLi4vdXRpbC9qc29uJztcblxuaW1wb3J0IHtQQVJBTUVURVJTfSBmcm9tICcuLi9jb25maWcnO1xuaW1wb3J0IHtQYXJhbWV0ZXJzfSBmcm9tICcuLi90eXBlcy9wYXJhbWV0ZXJzJztcblxuLyoqXG4gKiBQYXJzZXMgbWFuaWZlc3QgZmlsZSBhcyBhbiBvYmplY3QuIENoZWNrcyBpZiBwYXJhbWV0ZXIgZmlsZSBpcyBwYXNzZWQgdmlhIENMSSwgdGhlbiBsb2FkcyBpdCB0b28uXG4gKiBSZXR1cm5zIGNvbnRleHQsIHRyZWUgYW5kIHBhcmFtZXRlcnMgKGVpdGhlciB0aGUgZGVmYXVsdCBvbmUsIG9yIGZyb20gQ0xJKS5cbiAqL1xuZXhwb3J0IGNvbnN0IGxvYWQgPSBhc3luYyAoaW5wdXRQYXRoOiBzdHJpbmcsIHBhcmFtUGF0aD86IHN0cmluZykgPT4ge1xuICBjb25zdCByYXdNYW5pZmVzdCA9IGF3YWl0IG9wZW5ZYW1sRmlsZUFzT2JqZWN0PGFueT4oaW5wdXRQYXRoKTtcbiAgY29uc3Qge3RyZWUsIC4uLmNvbnRleHR9ID0gdmFsaWRhdGVNYW5pZmVzdChyYXdNYW5pZmVzdCk7XG4gIGNvbnN0IHBhcmFtZXRlcnNGcm9tQ2xpID1cbiAgICBwYXJhbVBhdGggJiYgKGF3YWl0IHJlYWRBbmRQYXJzZUpzb248UGFyYW1ldGVycz4ocGFyYW1QYXRoKSk7IC8vIHRvZG86IHZhbGlkYXRlIGpzb25cbiAgY29uc3QgcGFyYW1ldGVycyA9IHBhcmFtZXRlcnNGcm9tQ2xpIHx8IFBBUkFNRVRFUlM7XG5cbiAgcmV0dXJuIHtcbiAgICB0cmVlLFxuICAgIGNvbnRleHQsXG4gICAgcGFyYW1ldGVycyxcbiAgfTtcbn07XG4iXX0=